<html>
<head>
</head>
<body>
<div id="openseadragon1" style="width:100%;"></div>

<div id="switch-overlay" style="position:absolute;left:250px;top:5px">
<button onclick="switchOverlay()">Overlay</button>
</div>

<script src="lib/openseadragon/openseadragon.js"></script>
<script src="lib/OpenSeadragonScalebar/openseadragon-scalebar.js"></script>
<script src="lib/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
    var viewer = OpenSeadragon({
        id: "openseadragon1",
        prefixUrl: "lib/openseadragon/images/",
        visibilityRatio:1,
        preserveViewport: true,
        showNavigator: true,
        navigatorPosition: "ABSOLUTE",
        navigatorTop:      "40px",
        navigatorLeft:     "4px",
        navigatorHeight:   "120px",
        navigatorWidth:    "145px",
        referenceStripSizeRatio: 0.2,
        showReferenceStrip:  true,
        tileSources: [
        	"final/final.dzi"
		]
    });
    viewer.scalebar({
                type: OpenSeadragon.ScalebarType.MICROSCOPE,
                pixelsPerMeter: 500000,
                minWidth: "100px",
                location: OpenSeadragon.ScalebarLocation.TOP_RIGHT,
                xOffset: 5,
                yOffset: 10,
                stayInsideImage: true,
                color: "black",
                fontColor: "black",
                backgroundColor: "rgba(255, 255, 255, 0.5)",
                fontSize: "small",
                barThickness: 4
            });
    
    var svg;	// test SVG circle
    viewer.addHandler('open',function() {
    	$("body").append("<div class='overlay'></div>");//document.createElement("div");
    	var	el=$("div.overlay")[0];

	    svg=makeSVG('svg',{id:"myOverlay",xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"});
		$("body").append(svg);
	    $("svg").load("img/ISH_image562_nissl_series121129675.svg",function(){
	    	console.log("Overlay loaded");
	    	el.appendChild(svg);
			el.className="overlay";
			viewer.addOverlay({
				element:el,
				location:viewer.viewport.imageToViewportRectangle(new OpenSeadragon.Rect(0,0,viewer.source.width,viewer.source.height))
			});
			
			var zoom = viewer.viewport.viewportToImageZoom( viewer.viewport.getZoom(true));
			$("#svg2").attr("transform","scale("+6*zoom+")" );

			//transform();
		});
	    /*--------------------*/

    });
	viewer.addHandler('animation', function(event){
		transform()
	});

	function transform( ){
		var zoom = viewer.viewport.viewportToImageZoom( viewer.viewport.getZoom(true));
		$("#svg2").attr("transform","scale("+6*zoom+")" );
	}   
    function makeSVG(tag,attrs) {
    	var el=document.createElementNS("http://www.w3.org/2000/svg",tag);
    	for (var k in attrs)
    		el.setAttribute(k,attrs[k]);
    	return el;
    }
    
    function switchOverlay() {
    	if($("#svg2").css('display')=="none")
	    	$("#svg2").show();
		else
			$("#svg2").hide();
    }
</script>
</body>
</html>


